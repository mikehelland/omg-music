<!DOCTYPE html>
<html>
<head>
   <title>User - OpenMusic.Gallery</title>

   <link rel="stylesheet" href="css/main.css" type="text/css" />

</head>
<body>

   <header>
   <a class="main-page-link" href="index.htm">
         <span class="main-title-open">Open</span><span class="main-title-media">Music</span><span class="main-title-gallery">.Gallery</span>
      </a>
      <div class="title-bar-user-controls"></div>
   </header>

   <div class="main-body">

      <h1 class="user-username"></h1>
      <div class="main-separator"></div>

      <h4>External Sources</h4>
      <div id="sources-list"></div>

      <hr>
      <div>Add an external source: 
         <input placeholder="Source Name" id="add-source-name"></input>
         <input placeholder="https://path_to_audio_file" id="add-source-input"></input>
         <button id="add-source-button">Add</button>
      </div>
      
   </div>

   <script src="js/omgservice.js"></script>
   <script src="js/usercontrols.js"></script>
   <!--<script src="js/user.js"></script>-->
   <script>
    setupUserControls(document.getElementsByClassName("title-bar-user-controls")[0], function (user) {

        var sourcesDiv = document.getElementById("sources-list")
        var loadSources = () => {
            sourcesDiv.innerHTML = ""
            user.sources.forEach((source) => {
               var el = document.createElement("div")
               el.innerHTML = source.url
               sourcesDiv.appendChild(el)
            })
        }

        if (user.sources) {
           loadSources()
        }

         var addSource = (url) => {
            if (!user.sources) {
               user.sources = []
            }

            user.sources.push({url: url, name: addSourceName.value})
            loadSources()
            addSourceInput.value = ""

            omg.server.postHTTP("/user", user, function (e) {
                console.log(e)
            });
        }
        var addSourceInput = document.getElementById("add-source-input")
        var addSourceName = document.getElementById("add-source-name")
        var addSourceButton = document.getElementById("add-source-button")
        addSourceButton.onclick = (e) => {
           addSource(addSourceInput.value)
        }
        addSourceInput.onkeypress = (e) => {
           if (e.charCode === 13) {
            addSource(addSourceInput.value)
           }
        }
    });
   </script>

</body>
</html>
