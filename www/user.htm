<!DOCTYPE html>
<html>
<head>
   <title>User - OpenMusic.Gallery</title>

   <link rel="stylesheet" href="css/main.css" type="text/css" />
   <link rel="stylesheet" href="css/viewer.css" type="text/css" />

</head>
<body>

   <header>
      <a href="/"><span class="main-title-open">Open</span><span class="main-title-media">Music</span><span class="main-title-gallery">.Gallery</span></a>
      <div class="title-bar-user-controls"></div>
   </header>

   <div class="main-body">

      <div class="left-or-top-column">

      <h1 class="user-username">&nbsp;</h1>
      <div><a href="/logout">Log Out</a></div>
      <div class="user-info">
         Account created: <span class="user-created-at"></span>
      </div>

      <hr>
      <div class="user-info">
          Tip Jar Bitcoin address:
          <input id="btc-address">
      </div>

      <hr>

      <div class="user-info">
         Upload Usage:
         <span id="upload-usage"></span>
         <a href="docs/uploading.htm"><br>(About uploading)</a>
      </div>
     
      <hr>

      </div>
      
      <div class="main-column">
            <div class="feed-options">
                  <select id="filter-type">
                       <option value="">All Types</option>
                       <option value="SONG">Songs</option>
                       <option value="PLAYLIST">Playlists</option>
                       <option value="SECTION">Sections</option>
                       <option value="MELODY">Melodies</option>
                       <option value="BASSLINE">Basslines</option>
                       <option value="DRUMBEAT">Drumbeats</option>
                       <option value="SOUNDSET">SoundSets</option>
                  </select>
      
                  <form id="search-form">
                   <input class="main-search-input" id="query" name="q" placeholder="Search"></input>
                   <input class="main-search-submit" type="submit" value="OMG!"></input>
                  </form>
      
                   <span class="search-info-terms"></span>
            </div>      
      <div class="search-things">
         <!--<div class="user-thing">
         </div>-->
      </div>
      </div>

   </div>

   
   <script src="js/omgservice.js"></script>
   <script src="js/usercontrols.js"></script>
   <script src="js/search.js"></script>


   <script src="omg-music/tuna-min.js"></script>
   <script src="omg-music/omgclasses.js"></script>
   <script src="omg-music/omusic_player.js"></script>
   <script src="omg-music/fx.js"></script>
   <script src="js/omgservice.js"></script>
   <script src="js/embedded_viewer.js"></script>
   
   <script>
      setupUserControls(document.getElementsByClassName("title-bar-user-controls")[0], function (user) {
         /*omg.util.getUserThings({user: user, 
            resultList: document.getElementsByClassName("search-things")[0],
            showMenu: true               
         });*/

         document.getElementsByClassName("user-username")[0].innerHTML = user.username;

         document.getElementsByClassName("user-created-at")[0].innerHTML = omg.util.getTimeCaption(user.created_at);
         document.getElementById("upload-usage").innerHTML = 
            omg.util.getFileSizeCaption(user.uploaded_bytes) + " / " + 
            omg.util.getFileSizeCaption(user.upload_limit)

         omg.search({
            user:  user,
            resultList: document.getElementsByClassName("search-things")[0],
            metaData: true,
            viewerParams: {deleteButton: true}
         })

         if (user.btc_address) {
            user.btc_address = user.btc_address.trim();
         }
         var div = document.getElementById("btc-address");
         omg.ui.setupInputEvents(div, user, "btc_address", function () {
            omg.server.postHTTP("/user", user, function (e) {
               console.log(e)
            });
         });

         var searchForm = document.getElementById("search-form")
         var queryInput = document.getElementById("query")
         var filterTypeInput = document.getElementById("filter-type")
         searchForm.onsubmit = () => {
            omg.search({
               user:  user,
               resultList: document.getElementsByClassName("search-things")[0],
               metaData: true,
               viewerParams: {deleteButton: true},
               type: filterTypeInput.value,
               q: queryInput.value
            }) 
            return false
         }
         console.log(searchForm)
      });
   </script>

</body>
</html>
